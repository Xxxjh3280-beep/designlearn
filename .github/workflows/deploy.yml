name: Deploy to GitHub Pages

on:
  push:
    # å½“æ¨é€åˆ° main åˆ†æ”¯æ—¶è§¦å‘éƒ¨ç½²
    branches:
      - main
  # å…è®¸æ‰‹åŠ¨ä» Actions æ ‡ç­¾é¡µè§¦å‘éƒ¨ç½²
  workflow_dispatch:

# è®¾ç½®æƒé™ï¼Œéƒ¨ç½²åˆ° GitHub Pages éœ€è¦
permissions:
  contents: read
  pages: write
  id-token: write

# å–æ¶ˆæ‰€æœ‰å…ˆå‰è¿è¡Œçš„ä½œä¸š
concurrency:
  cancel-in-progress: true
  group: pages

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        
      - name: ğŸŸ¢ è®¾ç½® Node.js å’Œ pnpm ç¯å¢ƒ
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm' # å¯ç”¨ pnpm ç¼“å­˜
          
      - name: âš™ï¸ å®‰è£… pnpm 
        # ä½¿ç”¨ pnpm/action-setup@v3 æ¥å®‰è£… pnpm CLI
        uses: pnpm/action-setup@v3
        with:
          version: 8 
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: pnpm install 
        
      - name: ğŸ› ï¸ æ„å»ºé¡¹ç›®
        # âš ï¸ å…³é”®ä¿®æ­£ï¼šæ·»åŠ  pnpm run build å‘½ä»¤
        run: pnpm run build
        
      # æ³¨æ„ï¼šVite æ„å»ºé»˜è®¤è¾“å‡ºåˆ° 'dist' ç›®å½•
      - name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          # ä½¿ç”¨ GitHub Token è¿›è¡Œè®¤è¯
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # è¦éƒ¨ç½²çš„æ„å»ºç›®å½• (é»˜è®¤æ˜¯ dist)
          publish_dir: ./dist
          # éƒ¨ç½²åˆ†æ”¯ï¼Œé€šå¸¸ä½¿ç”¨ gh-pages
          publish_branch: gh-pages
          # æäº¤ä¿¡æ¯
          commit_message: "Deploy to GitHub Pages from ${{ github.ref }}"